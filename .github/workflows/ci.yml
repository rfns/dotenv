name: CI

on: [push]

jobs:
  tests:

    runs-on: ubuntu-latest

    steps:
    - name: Clone this repository
      uses: actions/checkout@v2
      with:
        path: app
    - name: Build and run
      run: |
        echo "${{ secrets.REGISTRY_PAT }}" > ~/GH_TOKEN.txt
        cat ~/GH_TOKEN.txt | docker login -u rfns --password-stdin docker.pkg.github.com
        docker run -t --rm --name ci --volume=$(pwd)/app:/opt/ci/root -e CI_NAMESPACE=USER -e CI_TESTSUITE=cls/UnitTest docker.pkg.github.com/rfns/iris-ci/iris-ci:v0.3.1

